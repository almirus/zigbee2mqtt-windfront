import{r as o,b as R,aw as N,j as s,C as w,T as k,c as E}from"./index-Cg_dwqpD.js";import{I as C}from"./InputField-D9KJc30P.js";import{C as y,A as S}from"./ClusterSinglePicker-TClcBWb_.js";import{E as q}from"./EndpointPicker-Dnt0o2EO.js";import"./envs-CSqIi4cL.js";import"./SelectField-dfeWrxvV.js";const D=["maximum_report_interval","minimum_report_interval","reportable_change","endpoint","cluster","attribute"],M=o.memo(({sourceIdx:a,rule:r,device:l,onApply:u})=>{const[t,m]=o.useState(r),{t:n}=R(["zigbee","common"]);o.useEffect(()=>{m(r)},[r]);const b=o.useCallback(e=>{m(i=>({...i,endpoint:e}))},[]),_=o.useCallback(e=>{m(i=>({...i,cluster:e}))},[]),g=o.useCallback(e=>{m(i=>({...i,attribute:e}))},[]),p=o.useCallback(e=>{const{name:i,valueAsNumber:d}=e.target;m(c=>({...c,[i]:d}))},[]),f=o.useCallback(()=>{u({...t,maximum_report_interval:65535})},[t,u]),x=o.useMemo(()=>N(l),[l]),v=o.useMemo(()=>{const e=new Set,i=new Set;t.cluster&&i.add(t.cluster);const d=l.endpoints[Number.parseInt(t.endpoint,10)];if(d){for(const c of d.clusters.output)i.add(c);for(const c of d.clusters.input)i.has(c)||e.add(c)}return[{name:"available",clusters:i},{name:"possible",clusters:e}]},[l.endpoints,t.endpoint,t.cluster]),j=o.useMemo(()=>D.every(e=>t[e]!==void 0&&t[e]!==""),[t]);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-row flex-wrap gap-2",children:[s.jsx(q,{label:n(e=>e.endpoint),disabled:!r.isNew,values:x,value:t.endpoint,onChange:b,required:!0}),s.jsx(y,{label:n(e=>e.cluster),disabled:!t.endpoint,clusters:v,value:t.cluster,onChange:_,required:!0}),s.jsx(S,{sourceIdx:a,label:n(e=>e.attribute),disabled:!t.cluster,value:t.attribute,cluster:t.cluster,device:l,onChange:g,required:!0}),s.jsx(C,{name:"minimum_report_interval",label:n(e=>e.min_rep_interval),type:"number",value:t.minimum_report_interval,onChange:p,required:!0,className:"input validator max-w-48"}),s.jsx(C,{name:"maximum_report_interval",label:n(e=>e.max_rep_interval),type:"number",value:t.maximum_report_interval,onChange:p,required:!0,className:"input validator max-w-48"}),s.jsx(C,{name:"reportable_change",label:n(e=>e.min_rep_change),type:"number",value:t.reportable_change,onChange:p,required:!0,className:"input validator max-w-48"}),s.jsxs("fieldset",{className:"fieldset",children:[s.jsx("legend",{className:"fieldset-legend",children:n(e=>e.actions)}),s.jsxs("div",{className:"join join-horizontal",children:[s.jsx(w,{title:n(e=>e.apply,{ns:"common"}),className:"btn btn-primary btn-outline join-item",item:t,onClick:u,disabled:!j,children:n(e=>e.apply,{ns:"common"})}),t.isNew?null:s.jsx(k,{title:n(e=>e.disable,{ns:"common"}),className:"btn btn-error btn-outline join-item",onClick:f,modalDescription:n(e=>e.dialog_confirmation_prompt,{ns:"common"}),modalCancelLabel:n(e=>e.cancel,{ns:"common"}),children:n(e=>e.disable,{ns:"common"})})]})]})]}),s.jsx("div",{className:"divider my-1"})]})}),h=a=>({isNew:a,reportable_change:0,minimum_report_interval:60,maximum_report_interval:3600,endpoint:"",cluster:"",attribute:""}),I=a=>{const r=[];for(const l in a.endpoints){const u=a.endpoints[l];for(const t of u.configured_reportings)r.push({...t,endpoint:l})}return r},$=a=>`${a.isNew}-${a.endpoint}-${a.cluster}-${a.attribute}`;function T({sourceIdx:a,device:r}){const[l,u]=o.useState(h(r.ieee_address)),t=o.useMemo(()=>I(r),[r]);o.useEffect(()=>{u(h(r.ieee_address))},[r.ieee_address]);const m=o.useCallback(async n=>{const{cluster:b,endpoint:_,attribute:g,minimum_report_interval:p,maximum_report_interval:f,reportable_change:x}=n;await E(a,"bridge/request/device/configure_reporting",{id:r.ieee_address,endpoint:_,cluster:b,attribute:g,minimum_report_interval:p,maximum_report_interval:f,reportable_change:x,option:{}})},[a,r.ieee_address]);return s.jsx("div",{className:"flex flex-col w-full",children:[...t,l].map(n=>s.jsx(M,{sourceIdx:a,rule:n,device:r,onApply:m},$(n)))})}export{T as default};
