import{b as y,a as r,k as n,r as _,j as s,t as u,L as f,F as m,K as F,cY as T,cZ as M,M as D,S as z,c_ as R,f as q}from"./index-Cg_dwqpD.js";import{u as L,T as $}from"./useTable-B3JMT6Iq.js";import{D as A}from"./DeviceImage-CHwoOcls.js";import{I as C}from"./InfoAlert-B2RwtOeQ.js";import{T as V}from"./Table-FUtHXzGb.js";import{f as o}from"./format-BHlbVbae.js";import"./envs-CSqIi4cL.js";import"./DebouncedInput-E4d1IUlA.js";import"./index-BbB5QEu8.js";function W({sourceIdx:c}){const{t:a,i18n:d}=y(["health","settings","common","zigbee"]),t=r(n(e=>e.bridgeHealth[c])),x=r(n(e=>e.devices[c])),i=r(n(e=>e.webSocketMetrics[c])),b=r(n(e=>e.readyStates[c])),h=R[b],w=_.useMemo(()=>{const e=[];if(t)for(const l in t.devices){const p=x.find(k=>k.ieee_address===l);p&&e.push({device:p,health:t.devices[l]})}return e},[t,x]),S=_.useMemo(()=>[{id:"friendly_name",minSize:175,header:a(e=>e.friendly_name,{ns:"common"}),accessorFn:({device:e})=>`${e.friendly_name} ${e.description??""}`,cell:({row:{original:{device:e}}})=>s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"avatar",children:s.jsx("div",{className:"h-11 w-11",style:{overflow:"visible"},children:s.jsx(A,{device:e,disabled:!1})})}),s.jsxs("div",{className:"flex flex-col min-w-0",children:[s.jsx(f,{to:`/device/${c}/${e.ieee_address}/info`,className:"link link-hover truncate",children:e.friendly_name}),e.friendly_name!==e.ieee_address?e.ieee_address:null]})]}),sortingFn:(e,l)=>e.original.device.friendly_name.localeCompare(l.original.device.friendly_name),filterFn:"includesString",meta:{filterVariant:"text",textFaceted:!0}},{id:"ieee_address",minSize:175,header:a(e=>e.ieee_address,{ns:"zigbee"}),accessorFn:({device:e})=>`${e.ieee_address} ${u(e.network_address,4)} ${e.network_address}`,cell:({row:{original:{device:e}}})=>s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsx(f,{to:`/device/${c}/${e.ieee_address}/info`,className:"link link-hover",children:e.ieee_address})}),s.jsxs("div",{className:"flex flex-row gap-1",children:[s.jsx("span",{className:"badge badge-ghost badge-sm cursor-default",title:a(l=>l.network_address_hex,{ns:"zigbee"}),children:u(e.network_address,4)}),s.jsx("span",{className:"badge badge-ghost badge-sm cursor-default",title:a(l=>l.network_address_dec,{ns:"zigbee"}),children:e.network_address})]})]}),sortingFn:(e,l)=>e.original.device.ieee_address.localeCompare(l.original.device.ieee_address),filterFn:"includesString",meta:{filterVariant:"text"}},{id:"messages",header:a(e=>e.messages),accessorFn:({health:e})=>e.messages,filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"messages_per_sec",header:a(e=>e.messages_per_sec),accessorFn:({health:e})=>e.messages_per_sec,cell:({row:{original:{health:e}}})=>s.jsx("span",{className:e.messages_per_sec>1?e.messages_per_sec>3?"text-error":"text-warning":e.messages_per_sec<.2?"text-success":"",children:e.messages_per_sec<=.001?a(l=>l.very_low):e.messages_per_sec}),filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"leave_count",header:a(e=>e.leave_count),accessorFn:({health:e})=>e.leave_count,filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"network_address_changes",header:a(e=>e.network_address_changes),accessorFn:({health:e})=>e.network_address_changes,filterFn:"inNumberRange",meta:{filterVariant:"range"}}],[c,a]),v=L({id:"health-devices",columns:S,data:w,sorting:[{id:"friendly_name",desc:!1}]});if(t.response_time===0)return s.jsxs("div",{className:"alert alert-info alert-soft",role:"alert",children:[s.jsx(m,{icon:F,size:"2xl"}),a(e=>e.awaiting_next_check)]});const g=new Date(t.response_time),j=new Date(Date.now()-t.process.uptime_sec*1e3),N=new Date(i.lastMessageTs);return s.jsxs(s.Fragment,{children:[s.jsx(C,{children:a(e=>e.interview_info)}),s.jsxs("div",{className:"collapse collapse-arrow bg-base-100 shadow mb-3",children:[s.jsx("input",{type:"checkbox"}),s.jsxs("div",{className:"collapse-title text-lg font-semibold text-center w-full",children:[a(e=>e.os)," / ",a(e=>e.process)," / MQTT"]}),s.jsx("div",{className:"collapse-content",children:s.jsxs("div",{className:"flex flex-col gap-3 items-center mb-2 w-full",children:[s.jsxs("p",{className:"text-sm",title:g.toLocaleString(),children:[a(e=>e.last_check),": ",o(g,d.language)]}),s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[s.jsx("div",{className:"stat place-items-center",children:s.jsx("div",{className:"stat-value text-xl",children:a(e=>e.os)})}),t.os.load_average.some(e=>e!==0)&&s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.load_average)}),s.jsx("div",{className:"stat-value text-lg",children:t.os.load_average.join(", ")}),s.jsx("div",{className:"stat-desc",children:s.jsx("a",{href:T,target:"_blank",rel:"noreferrer",className:"link link-hover",children:"1min, 5min, 15min"})})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.ram_usage)}),s.jsxs("div",{className:"stat-value text-lg",children:[t.os.memory_percent," %"]}),s.jsxs("div",{className:"stat-desc",children:[t.os.memory_used_mb," MB"]})]})]}),s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[s.jsx("div",{className:"stat place-items-center",children:s.jsx("div",{className:"stat-value text-xl",children:a(e=>e.process)})}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.uptime)}),s.jsx("div",{className:"stat-value text-lg",children:o(j,d.language)}),s.jsx("div",{className:"stat-desc",children:j.toLocaleString()})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.ram_usage)}),s.jsxs("div",{className:"stat-value text-lg",children:[t.process.memory_percent," %"]}),s.jsxs("div",{className:"stat-desc",children:[t.process.memory_used_mb," MB"]})]})]}),s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[s.jsx("div",{className:"stat place-items-center",children:s.jsx("div",{className:"stat-value text-xl",children:a(e=>e.mqtt,{ns:"settings"})})}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-value text-lg",children:s.jsx(m,{icon:M,className:t.mqtt.connected?"text-success":"text-error"})}),s.jsxs("div",{className:"stat-desc",children:[a(e=>e.queued),": ",t.mqtt.queued]})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.published)}),s.jsx("div",{className:"stat-value text-lg",children:t.mqtt.published})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.received)}),s.jsx("div",{className:"stat-value text-lg",children:t.mqtt.received})]})]})]})})]}),s.jsxs("div",{className:"collapse collapse-arrow bg-base-100 shadow mb-3",children:[s.jsx("input",{type:"checkbox"}),s.jsx("div",{className:"collapse-title text-lg font-semibold text-center w-full",children:"WebSocket"}),s.jsx("div",{className:"collapse-content",children:s.jsxs("div",{className:"flex flex-col gap-3 items-center mb-2 w-full",children:[s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[D&&s.jsx("div",{className:"stat place-items-center",children:s.jsx("div",{className:"stat-value text-lg",children:s.jsx(z,{idx:c,alwaysShowName:!0})})}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-value text-lg",children:s.jsx(m,{icon:q,className:h?.[1]})}),s.jsx("div",{className:"stat-desc",children:h?.[0]})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.reconnects)}),s.jsx("div",{className:"stat-value text-lg",children:i.reconnects})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.pending_requests)}),s.jsx("div",{className:"stat-value text-lg",children:i.pendingRequests})]})]}),s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.last_message)}),s.jsx("div",{className:"stat-value text-lg",children:o(N,d.language)}),s.jsx("div",{className:"stat-desc",children:N.toLocaleString()})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.sent)}),s.jsx("div",{className:"stat-value text-lg",children:i.messagesSent}),s.jsxs("div",{className:"stat-desc",children:[Math.round(i.bytesSent/1024/1024*100)/100," MB"]})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.received)}),s.jsx("div",{className:"stat-value text-lg",children:i.messagesReceived}),s.jsxs("div",{className:"stat-desc",children:[Math.round(i.bytesReceived/1024/1024*100)/100," MB"]})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsxs("div",{className:"stat-title",children:[a(e=>e.received),": ",a(e=>e.bridge,{ns:"settings"})]}),s.jsx("div",{className:"stat-value text-lg",children:i.messagesBridge})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsxs("div",{className:"stat-title",children:[a(e=>e.received),": ",a(e=>e.devices,{ns:"common"})]}),s.jsx("div",{className:"stat-value text-lg",children:i.messagesDevice})]})]})]})})]}),s.jsx("div",{className:"mb-3",children:s.jsx($,{...v})}),s.jsx("div",{className:"mb-5",children:s.jsx(V,{id:"health-devices",...v})})]})}export{W as default};
